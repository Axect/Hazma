\documentclass[review]{elsarticle}

\usepackage{hyperref}
\usepackage{verbatim}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{slashed}
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage{tikz}
\usetikzlibrary{decorations.pathmorphing}

\usepackage{minted}  % syntax highlighting
\definecolor{bg}{rgb}{0.94,0.94,0.94}
\usemintedstyle{pastie}
\newcommand{\mil}[1]{\mintinline{python}{#1}}

\journal{Computer Physics Communications}

% Numbered without titles
\bibliographystyle{model1a-num-names}

% `Elsevier LaTeX' style
%\bibliographystyle{elsarticle-num}

\newcommand{\us}[1]{{~\mathrm{#1}}}
\renewcommand\u[1]{{\mathrm{#1}}}
\renewcommand\L{\mathcal{L}}
\renewcommand\d{\partial}

% hazma commands
% \newcommand{\hazma}{\texttt{hazma}}
% \newcommand{\theory}{\texttt{theory}}
% \newcommand{\sm}{\texttt{scalar\_mediator}}
% \newcommand{\vm}{\texttt{vector\_mediator}}
\newcommand{\hazma}{\mil{hazma}}
\newcommand{\theory}{\mil{theory}}
\newcommand{\sm}{\mil{scalar_mediator}}
\newcommand{\vm}{\mil{vector_mediator}}
\newcommand{\svann}{\langle \sigma v \rangle_{\bar{\chi} \chi}}




\begin{document}




\begin{frontmatter}

	\title{Hazma\tnoteref{mytitlenote}}
	\tnotetext[mytitlenote]{Code and tutorials available at \href{https://github.com/LoganAMorrison/Hazma}{github.com/LoganAMorrison/Hazma}.}

	\author[grappa,ucsc,scipp]{Adam Coogan}
	\ead{a.m.coogan@uva.nl}

	\author[ucsc,scipp]{Logan A. Morrison}
	\ead{loanmorr@ucsc.edu}

	\address[grappa]{GRAPPA, Institute of Physics, University of Amsterdam, 1098 XH Amsterdam, The Netherlands}
	\address[ucsc]{Department of Physics, 1156 High St., University of California Santa Cruz, Santa Cruz, CA 95064, USA}
	\address[scipp]{Santa Cruz Institute for Particle Physics, 1156 High St., Santa Cruz, CA 95064, USA}

	\begin{abstract}
		Hazma does many wonderful things.
	\end{abstract}

	\begin{keyword}
		Dark matter \sep indirect detection
	\end{keyword}

\end{frontmatter}

\section{Introduction}

Hazma is great.

\paragraph{Notation/units} Unless otherwise noted, the units used throughout \hazma\ are
\begin{itemize}
	\item Masses: MeV
	\item Decay widths: MeV
	\item Cross sections: $\u{cm}^3 / \u{s}$
	\item The \mil{numpy} package is referred to in some of the code snippets.
	\item We have sometimes rounded or formatted the output from \mil{hazma} to make the code snippets more readable.
\end{itemize}

\section{Installation and Package Structure}%
\label{sec:installation}

\subsection{Installation}

Before installing \texttt{hazma}, the user needs to have a few of well-established packages : cython, scipy, numpy, and scikit-image. Theses are easily installed by using PyPi. If the user has PyPi installed on their system, then these packages can be installed using
\begin{verbatim}
	pip install cython, scipy, numpy, scikit-image, matplotlib
\end{verbatim}
Hazma can be installed in the same way, using:
\begin{verbatim}
	pip install hazma
\end{verbatim}
This will download a tarball from the PyPi repository, compile all the c-code and install \texttt{hazma} on the system. Alternatively, the user can install \texttt{hazma} by downloading the package from \url{https://github.com/LoganAMorrison/Hazma.git}. Once downloaded, navigate to the package directory using the command line and run either
\begin{verbatim}
	pip install .
\end{verbatim}
or
\begin{verbatim}
	python setup.py install
\end{verbatim}


Note that since \texttt{hazma} makes extensive usage of the package cython, the user will need to have a c-compiler installed on their system. For more information, see the cython installation guide: \url{https://cython.readthedocs.io/en/latest/src/quickstart/install.html}




\section{Overview: The \texttt{theory} Class}%
\label{sec:overview_the_theory_class}

\input{sections/overview_the_theory_class}

\subsection{Gamma-ray and Positron Spectra}
The gamma-ray spectrum \(dN/dE\) for an initial state \(A\) decaying or annihilating into the final state \(B + n\gamma\), where \(B\) is a set of particles not containing a photon and \(n\) being the number of photons produced, is computed at leading order in \(\alpha_{\mathrm{EM}}\)	using:
\begin{align}
	\dfrac{dN(A\to B + n\gamma)}{dE} = \dfrac{1}{\sigma(A\to B)}\sum_{i=1}^{n}\dfrac{d\sigma(A\to B + n\gamma)}{dE_{i}} + \mathcal{O}(\alpha_{\mathrm{EM}}^{2})
\end{align}
where \(E_{i}\) is the energy of the \(i^{\mathrm{th}}\) photon. \hazma\ implements two types of gamma-ray spectra: decay spectra and final-state radiation (FSR).

\subsubsection{Decay Spectra}

Decay spectra are defined as spectra from proccess where the the inital state particle(s) \(A\) decays(annihilates) into a final state \(B + C\) which contains an unstable particle \(C\), which decays radiatively (i.e. \(C \to D + n\gamma\) where \(D\) is some set of particles not including a photon and \(n\) is the number of photons produced from the decay of \(C\)). An example of this is two dark matter particles annihilating into two muons: for which one (or both) of the muons decays to radiatively into \(e^{+}\nu_{e}\nu_{\mu}\gamma\). Decay spectra can be computed using the narrow width approximation. In this approximation, the non-radiative and radiative cross-sections can be factored:
\begin{align}
	\sigma(A\to B + C \to B + D)           & \approx \sigma(A \to B + C)\times\Gamma(C\to D)           \\
	\sigma(A\to B + C \to B + D + n\gamma) & \approx \sigma(A \to B + C)\times\Gamma(C\to D + n\gamma)
\end{align}
Thus, the decay spectra can be approximated using:
\begin{align}
	\dfrac{dN(A\to B + C \to B + D + n\gamma)}{dE} \approx \dfrac{1}{\Gamma(C\to D)}\sum_{i=1}^{n}\dfrac{d\Gamma(C\to D + n\gamma)}{dE_{i}}
\end{align}
\hazma\ has built in the decay spectra for the muon, the charged pion and the neutral pion. The radiative decay modes taken into account for the muon are:
\begin{align}
	\mu^{\pm} & \to e^{\pm}\nu_{e}\nu_{\mu}\gamma
\end{align}
The radiative decay modes taken into account for the charged pion are:
\begin{align}
	\pi^{\pm} & \to \mu^{\pm}\nu_{\mu}\gamma                                     \\
	\pi^{\pm} & \to e^{\pm}\nu_{e}\gamma                                         \\
	\pi^{\pm} & \to \mu^{\pm}\nu_{\mu}\to e^{\pm}\nu_{e}\nu_{\mu}\nu_{\mu}\gamma
\end{align}
The radiative decay modes taken into account for the neutral pion are:
\begin{align}
	\pi^{0} & \to \gamma\gamma
\end{align}
The formulas for these spectra are given in an appendix. To compute decay spectra in \hazma\, the user needs to import the decaying particle from \mil{hazma.decay}. For example:
\begin{minted}[bgcolor=bg]{python}
>>> from hazma.decay import muon, neutral_pion, charged_pion
\end{minted}
Each function in \mil{hazma.decay} accepts a list of gamma-ray energies as the first argument and the particle energy as the second. It is easiest to create arrays of gamma-ray energies using \mil{numpy}:
\begin{minted}[bgcolor=bg]{python}
>>> import numpy as np
>>> eng_gams = np.logspace(0., 3., num=10)
\end{minted}
The spectra are then created by calling:
\begin{minted}[bgcolor=bg]{python}
>>> eng_mu, eng_npi, eng_cpi = 200., 300., 400.
>>>
>>> mu_spec = muon(eng_gams, eng_mu)
>>> npi_spec = neutral_pion(eng_gams, eng_mu)
>>> cpi_spec = charged_pion(eng_gams, eng_mu)
\end{minted}
These functions will compute the gamma-ray spectra evaluted at the gamma-ray energies passed into each function.



\subsubsection{FSR}
FSR spectra are defined as proccess in which the initial state particle(s) directly decay(annihilate) into a final state contains a photon.

\subsubsection{Boost Integrals}
In the case of decay spectra, it is easiest to compute the gamma-ray spectra in the rest frame of the decaying particle. However, we interested in the gamma-ray spectra in the frame in which we are performing observations or the \textit{lab frame}. Here we review how to boost a spectrum $dN/dE_R$ from the parent particle's rest frame to obtain the ``lab frame'' spectrum $dN/dE_L$, where the particle has boost $\gamma = E / m$ along the $z$-axis. Let the photon phase space coordinates be $(E_R, \cos\theta_R)$ in the rest frame and $(E_L, \cos\theta_L)$ in the lab frame, where $\theta_R$ and $\theta_L$ are the angles with respect to the $z$ axis and we have assumed azimuthal symmetry. Since the number of photons in a small patch of phase space does not depend on which coordinates we choose, we have
\begin{align}\label{eqn:frame_trans_spec}
    dN &= f(E_R, \cos \theta_R)\ dE_R\ d\cos\theta_R\\
       &= \begin{vmatrix}
            \frac{dE_R}{dE_L} & \frac{dE_R}{d\cos\theta_L}\\
            \frac{d\cos\theta_R}{dE_L} & \frac{d\cos\theta_R}{d\cos\theta_L}
        \end{vmatrix} f(E_R(E_L, \cos\theta_L), \cos\theta_R(E_L, \cos\theta_L)) dE_L\ d\cos\theta_L,
\end{align}
where we recognize the partial phase space density as $f(E, \cos\theta) \equiv dN/(dE\ d\cos\theta)$ and the term with the two vertical lines is the Jacobian factor for the change of variables. If \(f(E_R, \cos\theta_R)\) is independent of \(c\theta_R\) (which is the case for all the spectra we will consider), we can write:
\begin{align}
  f(E_{R}, c\theta_{R}) = \dfrac{1}{2}\dfrac{dN}{dE_{R}}.
\end{align}
The variables \(E_{1}, E_{2}, c\theta_{1}\) and \(c\theta_{2}\) are related via a Lorentz boost. The relationships are
\begin{align}
  E_R &= \gamma E_L (1 - \beta c\theta_L),\\
  \cos\theta_R &= \dfrac{\beta - \cos\theta_L}{1 - \beta \cos\theta_L}
\end{align}
where \(\beta = \sqrt{1 - 1 / \gamma^2}\) is the particle's velocity in natural units. The spectrum in the lab frame is then obtained by integrating Eqn.~(\ref{eqn:frame_trans_spec}) over \(\cos\theta_L\):
\begin{align}\label{eq:spec_boost}
  \dfrac{dN}{dE_L} & = \int \cos\theta_L\dfrac{1}{2\gamma(\beta \cos\theta_L - 1)}\dfrac{dN}{dE_R}.
\end{align}

\begin{figure}
	\centering
	\begin{tikzpicture}
		\node at (-3, 1.5) {Rest Frame};
		\node at (3, 1.5) {Lab Frame};
		\node at (-3, 0) {\textbullet};
		\draw[->,decorate,decoration=snake] (-3, 0) -- (-2.29, 0.71);
		\draw[->,decorate,decoration=snake] (-3, 0) -- (-3.71, -0.71);
		\node at (-2., 0.71) {$\gamma_{1}$};
		\node at (-4, -0.71) {$\gamma_{2}$};
		\node at (-3.3, 0.2) {$B$};
		\node at (2, 0) {\textbullet};
		\node at (3, 0) {\textbullet};
		\draw[->] (2, 0) -- (2.9, 0);
		\draw[->,decorate,decoration=snake] (3, 0) -- (5.20294, 0.707107);
		\draw[->,decorate,decoration=snake] (3, 0) -- (3.06485, -0.707107);
		\node at (1.7, 0.2) {$B$};
		\node at (5.5, 0.707107) {$\gamma_{1}$};
		\node at (3.5, -0.707107) {$\gamma_{2}$};
		\node at (-0.2, -2.5) {\includegraphics[scale=0.3]{figures/lab_rest_frame.pdf}};
		\draw[->,ultra thick] (-0.75, -0.75) -- (0.75, -0.75);
		\node at  (0.0, -0.35) {Lorentz Boost};
	\end{tikzpicture}
	\caption{}
	\label{}
\end{figure}


\section{How Hazma Works}%
\label{sec:how_hazma_works}

\section{Advanced Usage}%
\label{sec:advanced_usage}

\begin{itemize}
	\item Make a list or graphic showing what the user has to implement.
\end{itemize}

\section{Conclusion}%
\label{sec:conclusion}


\section{Bibliography}

Here are two sample references: \cite{Feynman1963118,Dirac1953888}.

\section*{References}

\bibliography{hazma_manual}

\end{document}
